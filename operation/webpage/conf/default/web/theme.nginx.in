uwsgi_cache_path  /var/lib/nginx/theme_cache  levels=1:2   keys_zone=theme_cache:100m  max_size=500m;
server {
    listen           %(web_port)s;
    server_name      theme.dolphin-browser.com;
	gzip             on;
	gzip_comp_level  6;
	gzip_min_length  1000;
        gzip_proxied any;
        gzip_buffers 16 8k;
	gzip_types       application/javascript text/plain text/css application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript;
	gzip_disable     "msie6";

    root /var/app/enabled/web/static/pages/theme;

    log_format theme_access '$remote_addr - $remote_user [$time_local]  '
                '"$request" $status $body_bytes_sent '
                '$request_time $upstream_response_time '
                '$upstream_cache_status '
                '"$http_referer" "$http_user_agent"';

    access_log       %(log_dir_base)s/web/access.log theme_access;

	error_log       %(log_dir_base)s/web/error.log;
	index		 index.html index.htm index.php;

    proxy_connect_timeout 30;
    proxy_read_timeout 120;
    proxy_send_timeout 120;

    proxy_redirect off;
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

	set $foreign_addr $remote_addr;
	if ($http_x_real_ip) {
		set $foreign_addr $http_x_real_ip;
	}
	
	proxy_set_header X-Real-IP $foreign_addr;
	
        location ~(favicon.ico) {
            alias /var/app/enabled/dolphinop-webfront/static/favicon.ico;
            log_not_found off;
            access_log off;
            expires 30d;
            break;
        }

    location /static {
        alias /var/app/enabled/web/static/;
    }

    location /api {
        uwsgi_pass dolphinop;
        include uwsgi_params;
        uwsgi_cache theme_cache;
        uwsgi_cache_key $request_uri;
        uwsgi_cache_valid 200 304 5m;
        uwsgi_cache_valid any 1m;
    }

    location / {
         try_files $uri $uri/ /index.html;
    }

    location /themecenter {
         try_files $uri $uri/ /index.html;
    }        
}

