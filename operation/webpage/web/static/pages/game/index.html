<!Doctype HTML>
<html>
<head>
	<meta name="format-detection" content="telephone=no">
	<meta http-equiv="Cache-Control" content="no-transform"> 
	<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no">
	<title>GameCenter-myGame</title>
	<style>	
		body{background-color: #3d434b;margin: 0;padding: 0;text-align: center;font-family:Arial,Verdana,Sans-serif;}
		.wenliBg{background-image: url(images/wenli_bg.png);z-index: -1;}
		.myGameBg{width: 92%;position:absolute;margin-left: 4%;margin-right: 4%}
		.topBar{position:fixed;top:0px;left:0px;width:100%;-webkit-box-shadow:0 0 24px #000;background:-webkit-gradient(linear,left top,left bottom,from(#737d80),to(#51565d));z-index:10}
		#center{margin:0 auto;height: 50px}
		.showCabinet .centerLeft{width:34px;margin:17px 10px 0 33px}
		.centerRight{width:60px;height:20px;margin:18px 0 0}
		.rightIco{width:30px;height:20px;float:right;margin:18px 14px 0 0}
		.barText{float:left;margin-top:16px;font:18px Arial,Verdana,Sans-serif;color:#cecece;}
		.sentToTopBar #center{width: 157px}
		.bottomBar #center{width: 105px}
		.hideCabinet .centerLeft{float:left;margin:19px 10px 0 0}
		.sentToTopBar .centerLeft{width:12px;}
		.bottomBar .centerLeft{width:15px;}
		.showCabinet .gameCabinet{height:155px;background-image:url(images/shangmian_left.png),url(images/shangmian_right.png),url(images/bg_descrption_1.png),url(images/bg_descrption_3.png),url(images/shangmian_2.png),url(images/bg_descrption_2.png);background-repeat:no-repeat,no-repeat,no-repeat,no-repeat,repeat-x,repeat-x;background-position:0 97px,right 97px,0 115px,right 115px,0 97px,0 115px;background-size: 4% 22px,4% 22px,auto,auto,auto,auto}
		.showCabinet .titleBg{background-image: url(images/bg_wenzi.png);background-position: 0px 124px;background-repeat: no-repeat;background-size: 100% 19px }
		.gameCabinet .gameBox{display:inline-block;margin: 0 10px;padding:0;width: 80px;height:155px;}
		.hideCabinet{ overflow: hidden;}
		.mainContent{margin-top:50px;}
		.hideCabinet .topBar,.showCabinet .sentToTopBar,.showCabinet .bottomBar{display: none}
		.hideCabinet .sentToTopBar{position:fixed;top:0px;width:100%;height:50px;border-bottom: 1px solid #ccc;background-image:url(images/sendBg.png);background-repeat: repeat-x;z-index: 200}
		.hideCabinet .bottomBar{position:fixed;left:0px;bottom:0px;width:100%;height:50px;background-image: url(images/bg.png);background-repeat: repeat-x;-webkit-box-shadow:0 0 24px #000; z-index: 200}
		.mainContent{margin-right:auto;margin-left:auto;position:relative;hight:100%}
		.deleIco{position:absolute;top:5px;right:5px;z-index:10;width:20px;}
		.showCabinet .deleIco{display:none;};
		.deleIco:hover{backgound-color:red;}
		/*可拖动区域*/
		#addIco{-webkit-transition:left 0.4s linear,top 0.4s linear;}
		.icoArea{position: absolute;width:300px;margin: 0 auto; text-align: left;}
		.icoArea div{position: absolute;width: 100px;height: 155px;margin:0}
		.icoArea div img{margin: 30px 0 0 16px}
		.icoArea div span{font-size: 14px;display: inline-block;margin: 14px 0 0 22px}
		.userMessage{ position: fixed;width:100%;top:25px;text-align: center;color:white;font-weight: bold;opacity:0}
		/*缩放动画*/
		@-webkit-keyframes suxiao{0%{-webkit-transform:scale(1)}20%{-webkit-transform:scale(1.1)}40%{-webkit-transform:scale(1.2)}60%{-webkit-transform:scale(1.3)}80%{-webkit-transform:scale(1.4)}100%{-webkit-transform:scale(1.5)}}	[animation='showClick']{-webkit-animation-name:suxiao;-webkit-animation-duration:0.5s;-webkit-animation-timing-function:ease-in-out;-webkit-animation-iteration-count:infinite;}
		@-webkit-keyframes initIco{0%{-webkit-transform:scale(0)}20%{-webkit-transform:scale(0.3)}40%{-webkit-transform:scale(0.6)}50%{-webkit-transform:scale(0.75)}60%{-webkit-transform:scale(0.9)}70%{-webkit-transform:scale(1.05)}80%{-webkit-transform:scale(1.2)}90%{-webkit-transform:scale(1.05)}100%{-webkit-transform:scale(1)}}	
		[animation='initShow']{-webkit-animation-name:initIco;-webkit-animation-duration:1.5s;-webkit-animation-timing-function:linear;}
		@-webkit-keyframes removeIco{0%{-webkit-transform:scale(1)}20%{-webkit-transform:scale(0.8)}40%{-webkit-transform:scale(0.6)}50%{-webkit-transform:scale(0.5)}60%{-webkit-transform:scale(0.4)}70%{-webkit-transform:scale(0.3)}80%{-webkit-transform:scale(0.2)}90%{-webkit-transform:scale(0.1)}100%{-webkit-transform:scale(0)}}	
		[animation='removeShow']{-webkit-animation-name:removeIco;-webkit-animation-duration:1s;-webkit-animation-timing-function:linear;}
		@-webkit-keyframes dialog{0%{opacity:1}20%{opacity:1}40%{opacity:1)}50%{opacity:1}60%{opacity:.8}70%{opacity:.6}80%{opacity:.4}90%{opacity:.2}100%{opacity:0;}}
		[animation="dialogshow"]{-webkit-animation-name:dialog;-webkit-animation-duration:2s;-webkit-animation-timing-function:linear;}
		[animation="dialogshow1"]{-webkit-animation-name:dialog;-webkit-animation-duration:2s;-webkit-animation-timing-function:linear;-webkit-animation-iteration-count:infinite;}
		/*for test*/
		.dA{position:absolute;width:92px !important;height:57px !important;background-image:url(images/dailog.png);overflow:hidden;top:0px;left:0px;padding:0;opacity:0}
		.dA p{font-size:13px;color:blue;line-height:16px;margin:4px 5px}
	</style>
	<script>
		var d = document,dd=document.documentElement;
		var W=dd.clientWidth||d.body.clientWidth;
		var H=window.innerHeight||dd.clientHeight||d.body.clientHeight;
		if(W>H){W +=H;H = W-H;W = W-H;} /*确保样式是竖屏*/
		var style = document.createElement('style');
		style.id="extraStyle";
		style.innerHTML = '.mainContent{width:'+W+'px} #icoArea{left:'+(W/2-155)+'px}';
		d.head.appendChild(style);
	</script>
</head>
<body>
<div class="showCabinet " id="changeState">
	<!-- sent to desktop 页面 -->
	<!-- start -->
	<div class="cover"></div>
	<div class="sentToTopBar" id="sentToTopBar">
		<div id="center">
			<img src="images/send.png" class="centerLeft"/>
			<span class="barText" >Send to desktop</span>
		</div>
	</div>
	<!-- end-->
	<!-- my game 页面-->
	<!-- start-->
	<div class="topBar">
		<img id="backTofeatured" src="images/gameCenter.png" class="rightIco"/>
		<div id="center"><img src="images/my.png" class="centerLeft"/>
			<img src="images/game.png" class="centerRight"/>
		</div>
	</div>
	<div class="wenliBg myGameBg">
	</div>
	<div class="mainContent" id="mainContent">
		<div id="icoArea" class="icoArea">
		</div>
			<div class="gameCabinet"><div class="titleBg gameBox"></div><div class="titleBg gameBox"></div><div class="titleBg gameBox"></div>
			</div>
			<div class="gameCabinet"><div class="titleBg gameBox"></div><div class="titleBg gameBox"></div><div class="titleBg gameBox"></div>
			</div>
			<div class="gameCabinet"><div class="titleBg gameBox"></div><div class="titleBg gameBox"></div><div class="titleBg gameBox"></div>
			</div>
	</div>
	<!-- end-->
	<!-- sent to desktop-->
	<div class="bottomBar" id="bottomBar">
		<div id="center">
			<img src="images/wancheng.png" class="centerLeft"/>
			<span class="barText" id="returnBtn" >Complete</span>
		</div>
	</div>
	<div class="userMessage" id="userMessage">已发送到桌面</div>
</div>
</body>
<script src="js/gameCenter.js"></script>
<script >
	var SH=Math.max(d.body.scrollHeight,dd.scrollHeight||0, H);
	(function(){
		var GCIndex = new GameCenter(),enableIcos=[],temp,input,dragDemo,targetId=null,treatMethod=null,localSet = GCIndex.getLocal('localSave'),boxState=[];
		if(GCIndex.isIos()){
			GCIndex.iosFixed(d.getElementById('sentToTopBar'),'top');
			GCIndex.iosFixed(d.getElementById('bottomBar'),'bottom');
		}
		backTofeatured.onclick=function(){window.location.href='featured.html'};
		if(!localSet){
			
			GCIndex.ajaxGet('url=http://172.16.9.151/pages/games/hoting.json?os=android&l=en_US',indexInit);
		}else{
			indexInit(localSet,true)
		}
		function indexInit(reText,offline){
		reText = JSON.parse(reText);
		if(!reText){
			return false;
		}
		if(!offline){
			var tmpArr={};
			for(var i=0,length=reText.length;i<length;i++){
				tmpArr[reText[i].id]={tit:reText[i].title,ico:reText[i].icon,id:reText[i].id,url:reText[i].download_url,isAdd:true};
				boxState[i]=reText[i].id;
			}
			localSet = {};
			localSet.readedGame =tmpArr;
			localSet.boxSave = boxState;
			GCIndex.setLocal('localSave',JSON.stringify(localSet));
		}else{
			localSet = reText;
			for(var i=0,length=boxState.length;i<length;i++){
				boxState[i] = localSet.boxSave[i];
			}
		}
		getId();
		if(icoInit()){
			temp =[];
			for(var i=0,length=enableIcos.length;i<length;i++){
				temp.push('ico'+i);
			}
			input = {parent:'icoArea',child:temp};
			GCIndex.initDrag(input,localSet,boxState);
			//dragDemo = new Drag(input);
			if(targetId!=null&&treatMethod){ //处理从detail页面过来的添加和删除
				var tempNode = d.getElementById('ico'+targetId),tmpLeft=tempNode.getAttribute('posL'),tmpTop=tempNode.getAttribute('posT');
				//tempNode.style.left = tmpLeft+'px'; tempNode.style.top = tmpTop+'px';
				tempNode.style.cssText='left:'+tmpLeft+'px;top:'+tmpTop+'px';				
				switch(treatMethod){
					case 'add':
						tempNode.setAttribute('animation','initShow');
						setTimeout(function(){tempNode.setAttribute('animation','');},1500);
						setTimeout(function(){tempNode.style.cssText='-webkit-transform: translate3d('+tmpLeft+'px,'+tmpTop+'px,0);'},1600);
					break;
					case 'remove':
						GCIndex.deleIco(tempNode);
						setTimeout(function(){GCIndex.saveBox();},1010); //延时执行配合删除动画
					break;
				}
			}
				addIco.style.display = '';
				GCIndex.showAnounce();
		}
		}
		function getId(){  //页面之间传值
			var tmpOrder = window.location.hash;
				if(tmpOrder!=''){
					treatMethod = tmpOrder.substring(1,tmpOrder.indexOf('&'));
					targetId = tmpOrder.substring(tmpOrder.indexOf('&')+1);
					window.location.hash = '';
					return true;
				}
			return false;
		}	
		function icoInit(){
			var myGame,intLeft,intTop,tmpHtml='',icoStyle='',findFlag=true;
			if(localSet){
				//localSet = JSON.parse(localSet);
				myGame = localSet.readedGame;
				for(var i=0,tmpLength=localSet.boxSave.length;i<tmpLength;i++){
					boxState[i] = localSet.boxSave[i];
				}
			}else{
				myGame = indexGet(getUrl);
				
				//localSet = {readedGame:myGame,boxSave:[]}
				//return false;
				//进行ajax请求
			}
			if(!myGame)
				return false;
			for(var i=0,length=boxState.length;i<length;i++){
				if(findFlag&&targetId&&boxState[i]==targetId){
					findFlag = false;
					targetId = i;
				}
				enableIcos[i]=myGame[boxState[i]]; 
			}
			for(i=0,length =enableIcos.length;i<length;i++){  //定义初始位置
				intLeft = (i%3)*100;intTop = Math.floor(i/3)*155;
				tmpTit = (enableIcos[i].tit.length>=10)?((enableIcos[i].tit.toLowerCase()).substr(0,8)+'…'):(enableIcos[i].tit.toLowerCase());
				tmpHtml+='<div '+((enableIcos[i].lastOpen)?("lastOpen="+enableIcos[i].lastOpen):"")+' id=ico'+i+' url="'+enableIcos[i].url+'" tit="'+tmpTit+'"style="-webkit-transform: translate3d('+intLeft+'px,'+intTop+'px,0);" posL="'+intLeft+'" posT="'+intTop+'" ico="'+enableIcos[i].ico+'"><img class="deleIco" src="images/delete.png"/><img src="'+enableIcos[i].ico+'"/><span>'+tmpTit+'</span></div>';
				//icoStyle+="#ico"+i+'{left:'+(i%3)*100+'px;top:'+Math.floor(i/3)*155+'px} '; //对ico进行初始排列
			}
			extraStyle.innerHTML += icoStyle+'.myGameBg{height:'+d.body.scrollHeight+'px}';
			//icoArea.innerHTML = tmpHtml+'<div id=ico><img src="images/addGame.png"/><span>添加新游戏</span></div>
			icoArea.innerHTML = tmpHtml+'<div id=addIco style="left:'+(i%3)*100+'px;top:'+Math.floor(i/3)*155+'px;display:none" onclick="window.location.href=\'featured.html\'"><img src="images/addGame.png"/><span>添加新游戏</span></div>';
			return true;
		}
		function indexGet(url){
			var tmpObject,gameArr;
			if(url&&url!=''){
				tmpObject = JSON.parse(GCIndex.ajaxGet(url));
				if(tmpObject){
					
				}else
					throw new Error('返回数据错误！');
			}
		}
	})();
</script>
</html>